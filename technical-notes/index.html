<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technical-notes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Hackathon notes | Onboard_D AI Agent Solution</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost:3000/m365-ai-agents-hackathon-onboard_D/technical-notes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hackathon notes | Onboard_D AI Agent Solution"><meta data-rh="true" name="description" content="Why choosing Langchain JS Over Teams AI library for LLM Orchestration?"><meta data-rh="true" property="og:description" content="Why choosing Langchain JS Over Teams AI library for LLM Orchestration?"><link data-rh="true" rel="icon" href="/m365-ai-agents-hackathon-onboard_D/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:3000/m365-ai-agents-hackathon-onboard_D/technical-notes"><link data-rh="true" rel="alternate" href="http://localhost:3000/m365-ai-agents-hackathon-onboard_D/technical-notes" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:3000/m365-ai-agents-hackathon-onboard_D/technical-notes" hreflang="x-default"><link rel="stylesheet" href="/m365-ai-agents-hackathon-onboard_D/assets/css/styles.fed2febf.css">
<script src="/m365-ai-agents-hackathon-onboard_D/assets/js/runtime~main.5cbe818b.js" defer="defer"></script>
<script src="/m365-ai-agents-hackathon-onboard_D/assets/js/main.7624a08f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/m365-ai-agents-hackathon-onboard_D/"><div class="navbar__logo"><img src="/m365-ai-agents-hackathon-onboard_D/img/onboard_d.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/m365-ai-agents-hackathon-onboard_D/img/onboard_d.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Onboard_D AI Agent Solution</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/FranckyC/m365-ai-agents-hackathon-onboard_D" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">
              <a style="display:flex" href="https://github.com/FranckyC/m365-ai-agents-hackathon-onboard_D" target="_blank" rel="noreferrer noopener" aria-label="Components playground">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32px" height="31px" viewBox="0 0 31 31" version="1.1">
                  <g id="surface1">
                  <path style="stroke:none;fill-rule:evenodd;fill:rgb(14.117648%,16.078432%,18.431373%);fill-opacity:1;" d="M 15.453125 0 C 6.910156 0 0 7.105469 0 15.894531 C 0 22.917969 4.425781 28.863281 10.566406 30.96875 C 11.335938 31.128906 11.617188 30.628906 11.617188 30.207031 C 11.617188 29.839844 11.589844 28.574219 11.589844 27.261719 C 7.292969 28.207031 6.394531 25.367188 6.394531 25.367188 C 5.707031 23.523438 4.683594 23.050781 4.683594 23.050781 C 3.273438 22.078125 4.785156 22.078125 4.785156 22.078125 C 6.34375 22.183594 7.164062 23.707031 7.164062 23.707031 C 8.546875 26.128906 10.773438 25.445312 11.667969 25.023438 C 11.792969 23.996094 12.203125 23.285156 12.640625 22.890625 C 9.210938 22.523438 5.601562 21.15625 5.601562 15.050781 C 5.601562 13.3125 6.21875 11.894531 7.191406 10.789062 C 7.035156 10.394531 6.5 8.761719 7.34375 6.578125 C 7.34375 6.578125 8.648438 6.15625 11.589844 8.210938 C 12.851562 7.863281 14.148438 7.683594 15.453125 7.683594 C 16.757812 7.683594 18.089844 7.867188 19.316406 8.210938 C 22.257812 6.15625 23.5625 6.578125 23.5625 6.578125 C 24.410156 8.761719 23.871094 10.394531 23.71875 10.789062 C 24.714844 11.894531 25.304688 13.3125 25.304688 15.050781 C 25.304688 21.15625 21.695312 22.496094 18.242188 22.890625 C 18.804688 23.390625 19.292969 24.339844 19.292969 25.839844 C 19.292969 27.96875 19.265625 29.679688 19.265625 30.207031 C 19.265625 30.628906 19.546875 31.128906 20.316406 30.96875 C 26.457031 28.863281 30.882812 22.917969 30.882812 15.894531 C 30.90625 7.105469 23.972656 0 15.453125 0 Z M 15.453125 0 "/>
                  </g>
                </svg>
              </a>
            </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/m365-ai-agents-hackathon-onboard_D/">Meet Onboard_D, your HR onboading coach!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/m365-ai-agents-hackathon-onboard_D/setup-environment">Setup the environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/m365-ai-agents-hackathon-onboard_D/agent-testing">Minimal path to awesome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/m365-ai-agents-hackathon-onboard_D/technical-notes">Hackathon notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/m365-ai-agents-hackathon-onboard_D/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hackathon notes</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hackathon notes</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-choosing-langchain-js-over-teams-ai-library-for-llm-orchestration">Why choosing Langchain JS Over Teams AI library for LLM Orchestration?<a href="#why-choosing-langchain-js-over-teams-ai-library-for-llm-orchestration" class="hash-link" aria-label="Direct link to Why choosing Langchain JS Over Teams AI library for LLM Orchestration?" title="Direct link to Why choosing Langchain JS Over Teams AI library for LLM Orchestration?">​</a></h2>
<p>We found Langchain to be more user-friendly and closely aligned with core LLM concepts compared to the Teams AI library, particularly in terms of tools management. Additionally, Langchain&#x27;s documentation is superior, offering clear usage examples. The only drawback is that integrating Langchain with Bot Framework features to build an end-to-end chat solution requires more effort.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-choosing-botbuilder-bot-framework-v4-over-the-new-microsoftagents-hosting-sdk-microsoft-365-agents-sdk">Why choosing &#x27;botbuilder&#x27; (Bot Framework V4) over the new &#x27;@microsoft/agents-hosting&#x27; SDK (Microsoft 365 Agents SDK)?<a href="#why-choosing-botbuilder-bot-framework-v4-over-the-new-microsoftagents-hosting-sdk-microsoft-365-agents-sdk" class="hash-link" aria-label="Direct link to Why choosing &#x27;botbuilder&#x27; (Bot Framework V4) over the new &#x27;@microsoft/agents-hosting&#x27; SDK (Microsoft 365 Agents SDK)?" title="Direct link to Why choosing &#x27;botbuilder&#x27; (Bot Framework V4) over the new &#x27;@microsoft/agents-hosting&#x27; SDK (Microsoft 365 Agents SDK)?">​</a></h2>
<p>We initially started building our solution using the new Microsoft 365 Agents JavaScript SDK. However, we quickly realized it wasn&#x27;t the best option for us due to several limitations:</p>
<ul>
<li><strong>Lack of parity with the traditional Bot Framework</strong>: The SDK didn&#x27;t allow us to easily achieve our goals, such as proactive notifications and conversation flows. We spent too much time figuring out how to accomplish tasks that were straightforward with the Bot Framework. Unfortunately, there is no migration guide available yet to assist with the transition. Given these challenges, we decided to stick with the familiar territory for time reasons.</li>
<li><strong>No tooling</strong>: The Microsoft 365 SDK is not integrated with the Teams Toolkit, making it harder to develop solutions quickly.</li>
<li><strong>Too much confusion between Teams AI library/Microsoft 365 Agents SDK/Bot Framework</strong>: Online, you&#x27;ll find numerous &quot;agents&quot; samples using various technology stacks (e.g., <a href="https://github.com/microsoft/Agents/blob/main/samples" target="_blank" rel="noopener noreferrer">M365 Agents SDK samples</a>, <a href="https://github.com/microsoft/teams-ai/tree/main/js/samples" target="_blank" rel="noopener noreferrer">Teams AI library samples</a>, <a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples" target="_blank" rel="noopener noreferrer">Bot Framework samples</a>). This can be very misleading for developers, as it creates confusion about which technology to use. In reality, developers often end up mixing concepts from all these samples.</li>
</ul>
<p>Ultimately, we concluded that the Microsoft 365 Agents SDK is not yet ready for the purpose of this hackathon.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-challenges-did-we-face">What challenges did we face?<a href="#what-challenges-did-we-face" class="hash-link" aria-label="Direct link to What challenges did we face?" title="Direct link to What challenges did we face?">​</a></h2>
<p>During the development, we actually faced many challenges!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="handling-different-json-tool-outputs-with-llm-and-adaptive-cards">Handling different JSON tool outputs with LLM and adaptive cards<a href="#handling-different-json-tool-outputs-with-llm-and-adaptive-cards" class="hash-link" aria-label="Direct link to Handling different JSON tool outputs with LLM and adaptive cards" title="Direct link to Handling different JSON tool outputs with LLM and adaptive cards">​</a></h3>
<p>In the solution, actions requested by the user may generate different UI outputs from the agent (sometimes just text, sometimes adaptive cards with heteregonous JSON formats). The challenge was to adapt these different outputs returned by LLM/tools to the correct UI in Teams:</p>
<div class="flex justify-center space-x-4"><div class="flex flex-col items-center"><p class="font-bold">Adaptive cards for list of assigned tasks</p><img class="" src="/m365-ai-agents-hackathon-onboard_D/assets/images/all_tasks_ui-e29b43039d8b7bb918cfb67577b664b0.png"></div><div class="flex flex-col items-center"><p class="font-bold">Adaptive cards for task details</p><img class="" src="/m365-ai-agents-hackathon-onboard_D/assets/images/task_detail_ui-cfd752b7a3abbd72f73ebc15e4a2614b.png"></div></div>
<br>
<p>Because the data format was dynamic, we couldn&#x27;t use a structured output for all the LLM answers (using either Langchain <a href="https://python.langchain.com/docs/concepts/structured_outputs/" target="_blank" rel="noopener noreferrer">structured outputs</a> or OpenAI <a href="https://platform.openai.com/docs/guides/structured-outputs" target="_blank" rel="noopener noreferrer"><code>json_schema</code></a>). For direct 1:1 mapping (tool output-&gt;adaptive card), we used the <a href="https://js.langchain.com/docs/how_to/tool_artifacts/" target="_blank" rel="noopener noreferrer">&#x27;artifact&#x27;</a> feature of Langchain to map the data returned by tools directly to adaptive cards instead of letting the LLM trying to figure out the JSON format to pass to the card (we did that at first and realized that was far from efficient and error prone!). Here is an example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Tool output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const getUserTasks = tool(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  async (args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> RunnableConfig) =&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tasks = await plannerService.getPlanTasks(planId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      `Successfully retrieved array of $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">tasks.length</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> tasks $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">JSON.stringify(tasks.map(t =&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> return </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t.id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t.title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> references</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t.references</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dueDateTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> t.dueDateTime </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">))</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> assigned to the user.`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Returned to the LLM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tasks </span><span class="token comment" style="color:#999988;font-style:italic">// Artifact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Usage in adaptive card</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case AgentTools.GetTasksForUsers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    card = AdaptiveCards.declare&lt;any&gt;(NotificationMessageAdaptiveCard).render(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> answer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> llmResponseContent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> llmResponse.messages</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">lastIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.artifact</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, for answers requiring mutliple tools to be invoked in sequence (for instance, asking for a task details would call two different tools <code>GetTaskDetails</code> and <code>SearchReferenceContent</code>, the first one to get the taks fields like title, due date, etc. and the second to search for content of documents referenced in the task in the search index to ,in the end generate a descriptive summary considering all theinformation), instead of instructing the model to create a JSON output, we had to create an other tool <code>GetTaskStructuredOutput</code> to structure the output from the data from previous called tools:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export const getTaskStructuredOutput = tool(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    async (args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> task</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">) =&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Task formatted successufly&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args.task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> AgentTools.GetTaskStructuredOutput</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;Format a task as structured output&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      responseFormat</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content_and_artifact&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      schema</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.object(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.object(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.string().describe(`title extract from the task`).nullable()</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          summary</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.string().describe(`generated summary of what user needs to do according to task description extract and retieved content from references if available. Text only</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> no markdown`).nullable()</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          priority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.number().describe(`priority extract from the task data`).nullable()</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          startDateTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.string().describe(`start date extract from the task data`).nullable()</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          dueDateTime</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.string().describe(`due date extract from the task data`).nullable()</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          deepLink</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> z.string().describe(`link extract from the task data`).nullable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">).nullable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">).describe(</span><span class="token string" style="color:#e3116c">&quot;the task details&quot;</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This tool establishes a clear schema outlining the expected data and returns it in its original form, ensuring it can be safely used as an artifact. We discovered that this method is significantly more efficient than having the LLM generate a JSON output. The truly challenging aspect, which required multiple attempts, was getting the LLM to utilize the final tool to format the output correctly. Here is the prompt we use to ensure the desired tool is employed:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## CAPABILITY: Get details about a specific task ##</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Examples: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - Give me more information about the &quot;...&quot; task.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - What is the task ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - Waht should i do for task #5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - If not provided, you **must** ask for task ID. Otherwise, lookup the task id in your chat history or use the one provided by user before using tool.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - If a task has references, retrieve associated content passing all URLs at once and summarize the content to clearly explain what about the task is.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Finally format the task as structured output using &lt;GetTaskStructuredOutput&gt; before answering.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="supporting-both-applicationdelegated-permissions-on-llm-tools-seamlessly">Supporting both application/delegated permissions on LLM tools seamlessly<a href="#supporting-both-applicationdelegated-permissions-on-llm-tools-seamlessly" class="hash-link" aria-label="Direct link to Supporting both application/delegated permissions on LLM tools seamlessly" title="Direct link to Supporting both application/delegated permissions on LLM tools seamlessly">​</a></h3>
<p>Because of the nature of the solution having both proactive notifactions and direct interactions with the agent, we needed to support both delegated and application access. Even if we could have use application permissions everywhere for convenient reasons, we wanted to create a secure solution handling bot type of permissions keeping it transparent for tools:</p>
<ul>
<li><em>Delegated permissions</em>: actions are performed on-behalf of the user when he interacts directly with the agent.</li>
<li><em>Application permissions</em>: actions are performed by the agent itself without any user interactions for proactive notifications.</li>
</ul>
<p>For this, we used the <a href="https://js.langchain.com/docs/concepts/tools#runnableconfig" target="_blank" rel="noopener noreferrer"><code>RunnableConfig</code></a> of Langchain pass parameters to tools using the following code:</p>
<ol>
<li>Instanciate a Microsoft Graph client like this:</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Delegated permissions </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const oboCredential = new OnBehalfOfUserCredential(tokenResponse.ssoToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oboAuthConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const authProvider = new TokenCredentialAuthenticationProvider(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oboCredential</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  scopes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MicrosoftGraphScopes.TasksReadWrite</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MicrosoftGraphScopes.SiteReadAll</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Application permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const appCredential = new AppCredential(appAuthConfig);           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const authProvider = new TokenCredentialAuthenticationProvider(appCredential</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	scopes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MicrosoftGraphScopes.Default</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Pass the provider to the tools when invoking the LLM:</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Pass the provider to tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const runnableConfig = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	authProvider</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> authProvider</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const llmResponse = await this.agent.invoke(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> messages </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runnableConfig</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Finally use it in tools:</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export const getUserTasks = tool(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  async (args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> RunnableConfig) =&gt; </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let tasks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> IPlannerTask</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Initialize Graph client instance with authProvider (can be app or delegated permissions her depending on the caller)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const graphClient = Client.initWithMiddleware(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> authProvider</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> config.configurable.authProvider </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const plannerService = new PlannerService(graphClient);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tasks = await plannerService.getPlanTasks(planId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="handling-human-in-the-loop-pattern-with-regular-bot-dialogs">Handling &#x27;Human-in-the-loop&#x27; pattern with regular bot dialogs<a href="#handling-human-in-the-loop-pattern-with-regular-bot-dialogs" class="hash-link" aria-label="Direct link to Handling &#x27;Human-in-the-loop&#x27; pattern with regular bot dialogs" title="Direct link to Handling &#x27;Human-in-the-loop&#x27; pattern with regular bot dialogs">​</a></h3>
<p>As said before, Langchain is totally &quot;chat implementation technolgy&quot; agnostic meaning you could build your own UI on top on it. In our case, we use the Bot Framework for that par and bot dialogs to handle this scenario with a dialog branches. If tools are selected by the LLM, before executing them, we check what tools need a human confirm, before proceding. This is done by doing the following:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Create a Langchain agent with prebuilt StateGraph</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const aiAgent = createReactAgent(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  llm</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> agentModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tools</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> agentTools</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  checkpointSaver</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> agentCheckpointer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interruptBefore</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;tools&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Human-in-the-loop: will stop the LLM after tools selection, letting you decide what to do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Tool validation in the main agent dialog:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Agent dialog</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const llmResponse = await this.agent.invoke(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> messages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> messages </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> runnableConfig</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Check invoked tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const toolCalls = llmResponse.messages</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">llmResponse.messages.length</span><span class="token number" style="color:#36acaa">-1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.tool_calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Data to be passed across dialogs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const modelData = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toolCalls</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> toolCalls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> as IAgentStepData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (const selectedTool of toolCalls) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Determine which tool needs a human in the loop and an explicit confirmation to be executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    switch (selectedTool?.name) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;UpdateTaskCompletion&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return await stepContext.beginDialog(HUMAN_IN_THE_LOOP_DIALOG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> modelData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/FranckyC/m365-ai-agents-hackathon-onboard_D/docs/4-technical-notes.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-04-29T02:41:42.000Z" itemprop="dateModified">Apr 29, 2025</time></b> by <b>Franck Cornu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/m365-ai-agents-hackathon-onboard_D/agent-testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Minimal path to awesome</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-choosing-langchain-js-over-teams-ai-library-for-llm-orchestration" class="table-of-contents__link toc-highlight">Why choosing Langchain JS Over Teams AI library for LLM Orchestration?</a></li><li><a href="#why-choosing-botbuilder-bot-framework-v4-over-the-new-microsoftagents-hosting-sdk-microsoft-365-agents-sdk" class="table-of-contents__link toc-highlight">Why choosing &#39;botbuilder&#39; (Bot Framework V4) over the new &#39;@microsoft/agents-hosting&#39; SDK (Microsoft 365 Agents SDK)?</a></li><li><a href="#what-challenges-did-we-face" class="table-of-contents__link toc-highlight">What challenges did we face?</a><ul><li><a href="#handling-different-json-tool-outputs-with-llm-and-adaptive-cards" class="table-of-contents__link toc-highlight">Handling different JSON tool outputs with LLM and adaptive cards</a></li><li><a href="#supporting-both-applicationdelegated-permissions-on-llm-tools-seamlessly" class="table-of-contents__link toc-highlight">Supporting both application/delegated permissions on LLM tools seamlessly</a></li><li><a href="#handling-human-in-the-loop-pattern-with-regular-bot-dialogs" class="table-of-contents__link toc-highlight">Handling &#39;Human-in-the-loop&#39; pattern with regular bot dialogs</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025</div></div></div></footer></div>
</body>
</html>